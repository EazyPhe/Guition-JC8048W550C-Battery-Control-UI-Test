# Guition-JC8048W550C-Battery-Control-UI-Test Project Documentation

## Overview

**Guition-JC8048W550C-Battery-Control-UI-Test** is a PlatformIO-based firmware project for the ESP32-S3 microcontroller, designed to drive an 800x480 RGB LCD panel (ST7262 controller) with capacitive touch (GT911) using the LVGL graphics library. The project is focused on a SquareLine Studio-generated UI (LVGL 8.3.x compatible).

---

## Hardware Platform

- **MCU:** ESP32-S3 (JC8048W550 board)
- **Display:** 800x480 RGB LCD (ST7262 controller, 16-bit parallel RGB interface)
- **Touch:** GT911 capacitive touch controller (I2C)
- **Backlight:** GPIO2 (active high)

### Pin Mapping (JC8048W550)

#### ST7262 RGB LCD (16-bit Parallel)
| Signal         | ESP32-S3 GPIO |
| -------------- | ------------- |
| HSYNC          | 39            |
| VSYNC          | 41            |
| DE             | 40            |
| PCLK           | 42            |
| R0             | 8             |
| R1             | 3             |
| R2             | 46            |
| R3             | 9             |
| R4             | 1             |
| G0             | 5             |
| G1             | 6             |
| G2             | 7             |
| G3             | 15            |
| G4             | 16            |
| G5             | 4             |
| B0             | 45            |
| B1             | 48            |
| B2             | 47            |
| B3             | 21            |
| B4             | 14            |
| Backlight      | 2             |

#### GT911 Touch Controller (I2C)
| Signal | ESP32-S3 GPIO |
| ------ | ------------- |
| SDA    | 19            |
| SCL    | 20            |
| INT    | 18            |
| RST    | 38            |

---

## Software Stack

- **Framework:** Arduino (via PlatformIO)
- **Graphics Library:** LVGL 8.3.11
- **Touch Library:** TAMC_GT911
- **Custom UI:** Generated by SquareLine Studio (LVGL 8.x compatible)

---

## Project Structure

- `platformio.ini` — PlatformIO configuration, board, and library dependencies
- `src/` — Main source code
  - `main.cpp` — Main application logic, LVGL/touch setup, UI initialization
  - `display_driver.cpp/.h` — LCD panel initialization and backlight control
  - `diagnostics.h` — System diagnostics and memory reporting
  - `ui_compat.h` — Compatibility helpers for SquareLine Studio UI
  - `ui/` — Auto-generated UI code from SquareLine Studio
- `include/lv_conf.h` — LVGL configuration (resolution, color depth, memory, etc.)
- `boards/` — Board JSONs for pinout and hardware config
- `sdkconfig*` — ESP-IDF/Arduino build and hardware settings

---

## Key Features & Flow

### 1. Initialization
- **Diagnostics:** Prints ESP32 chip info, heap/PSRAM stats, and LVGL version at startup.
- **Touch Controller:** Initializes GT911 via I2C (pins and address set in `main.cpp`).
- **LCD Panel:** Calls `lcd_panel_init()` (in `display_driver.cpp`) to set up the ST7262 panel using ESP-IDF's RGB panel driver.
- **LVGL:**
  - Initializes LVGL and allocates a DMA-capable buffer for display drawing.
  - Registers display and input device drivers with LVGL, providing flush and touch callbacks.

### 2. UI
- **SquareLine UI:**
  - Loads the UI generated by SquareLine Studio (see `src/ui/`).
  - UI screens and components are defined in C files, with event handlers and helpers.

### 3. LVGL Integration
- **Display Flush:**
  - `display_flush_cb()` is called by LVGL to push a region of pixels to the LCD using `esp_lcd_panel_draw_bitmap()`.
- **Touch Read:**
  - `touch_read_cb()` reads touch data from the GT911 and updates LVGL's input state.

### 4. Build & Configuration
- **LVGL Settings:**
  - Resolution, color depth, and memory settings are defined in `include/lv_conf.h`.
  - Custom memory allocators are used for ESP32 compatibility.
- **PlatformIO:**
  - Board, framework, and library dependencies are set in `platformio.ini`.
  - Build flags ensure correct LVGL and hardware configuration.
- **SDKConfig:**
  - ESP-IDF/Arduino settings for PSRAM, flash size, FreeRTOS, LCD, and touch are set in `sdkconfig.defaults` and `sdkconfig.JC8048W550`.

---

## UI Code (SquareLine Studio)
- All UI screens, components, and event handlers are auto-generated in `src/ui/`.
- Main entry point: `ui_init()` (see `ui.c`), which loads the default theme and screens.
- UI helpers and event stubs are provided for further customization.

---

## Custom Hardware Implementation Notes

- **Pin Mapping:** All display and touch pin assignments are defined in the board JSON (`boards/JC8048W550.json`) and in `main.cpp`.
- **Panel Timings:** The ST7262 panel timings (pixel clock, sync widths, porches) are set for 800x480@16MHz and can be adjusted in the board JSON and `display_driver.cpp`.
- **Backlight:** Controlled via GPIO2 (active high).
- **Touch:** GT911 is configured for I2C address 0x5D, with INT and RST pins as above.
- **Buffering:** LVGL uses a DMA-capable buffer for efficient drawing; buffer size and memory flags are set in `main.cpp` and the board JSON.
- **Custom Boards:** To adapt to a different ESP32 board or display, update the pin mappings and timings in a new board JSON and adjust the relevant macros in your code.
- **Reference:** See the `docs/ST7262_ESP32S3_LVGL8_Integration.md` for more in-depth hardware/software integration details.

---

## Troubleshooting
- **No display output:** Ensure `lcd_panel_init()` is implemented and the correct pins are set in the board JSON and `main.cpp`.
- **Touch not working:** Check GT911 wiring, I2C address, and pin assignments.
- **LVGL errors:** Confirm LVGL version and configuration match those required by SquareLine Studio (see `lv_conf.h`).

---

## References
- [LVGL Documentation](https://docs.lvgl.io/8.3/)
- [SquareLine Studio](https://squareline.io/)
- [ESP-IDF LCD RGB Panel](https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/api-reference/peripherals/lcd.html)
- [TAMC_GT911 Library](https://github.com/TAMCTec/TAMC_GT911)

---

*This documentation was updated May 2025. For hardware-specific details, refer to your board's datasheet and the `boards/` directory.*

*More updates to come as I learn more about this board. Stay Tuned!*
